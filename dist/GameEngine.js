!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.GameEngine=e():t.GameEngine=e()}(this,(function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="./dist",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class i{constructor(){this.handlers={}}on(...t){this.addEventListener(...t)}off(...t){this.removeEventListener(...t)}addEventListener(t,e){this.handlers.hasOwnProperty(t)||(this.handlers[t]=[]),this.handlers[t].push(e)}removeEventListener(t=null,e=null){}emit(t,...e){if(this.handlers.hasOwnProperty(t))for(const s of this.handlers[t])s(...e)}}class n extends i{constructor(t={}){super(),this.uid=u.generateUid(),this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.rotation=t.rotation||0,this.anchorX=t.anchorX||0,this.anchorY=t.anchorY||0,this.scale=t.scale||1,this.scaleX=t.scaleX||1,this.scaleY=t.scaleY||1,this.parent=null,this.visible=!0,void 0!==t.scale&&this.setScale(t.scale)}get scene(){return u.getScene(this)}get game(){return this.scene.parent}get absoluteX(){return this.x-this.anchorX*this.width*this.scaleX}set absoluteX(t){return this.x=t+this.anchorX*this.width*this.scaleX,t}get absoluteY(){return this.y-this.anchorY*this.height*this.scaleY}set absoluteY(t){return this.y=t+this.anchorY*this.height*this.scaleY,t}get centerX(){return this.absoluteX+this.width/2*this.scaleX}set centerX(t){return this.absoluteX=t-this.width/2}get centerY(){return this.absoluteY+this.height/2*this.scaleY}set centerY(t){return this.absoluteY=t-this.height/2}setScale(t){this.scaleX=t,this.scaleY=t}setParent(t){this.parent&&this.parent.remove&&this.parent.remove(this),t&&t.add&&t.add(this),this.parent=t}draw(t){this.visible&&t()}}class r extends n{constructor(t={}){super(t),this.displayObjects=[],delete this.width,delete this.height}add(...t){for(const e of t)this.displayObjects.includes(e)||(this.displayObjects.push(e),e.setParent(this))}tick(t){for(const e of this.displayObjects)e.tick&&e.tick(t)}remove(...t){for(const e of t)if(this.displayObjects.includes(e)){const t=this.displayObjects.indexOf(e);this.displayObjects.splice(t,1),e.setParent(null)}}draw(t,e){super.draw(()=>{e.save(),e.translate(this.x,this.y),e.rotate(-this.rotation),e.scale(this.scaleX,this.scaleY);for(const s of this.displayObjects)s.draw(t,e);e.restore()})}}class o extends r{constructor(t={}){super(),this.autoStart=t.autoStart||!1,this.name=t.name||"",this.status="waiting",this.stage=this.displayObjects,t.loading&&(this.loading=t.loading.bind(this)),t.init&&(this.init=t.init.bind(this)),t.update&&(this.update=t.update.bind(this)),t.beforeDestroy&&(this.beforeDestroy=t.beforeDestroy.bind(this))}loading(){}init(){}update(){}beforeDestroy(){}}const a={},h=[],c={delay:function(t,e=null){return a[t]?!(a[t]+e>Date.now())&&(a[t]=Date.now(),!0):(a[t]=Date.now(),!0)},generateUid:function(t=10){let e=l();for(;h.includes(e);)e=l();return e},isInside:function(t,e){return e.x<=t.x&&t.x<=e.x+e.width&&e.y<=t.y&&t.y<=e.y+e.height},removeElements:function(t,...e){for(const s of e)if(t.includes(s)){const e=t.indexOf(s);t.splice(e,1)}},getScene:function(t){return!t||t instanceof o?t:c.getScene(t.parent)},tween:function(t){let{target:e,duration:s,processer:i}=t;if(!e)throw new Error("Tween without target object.");let n=Date.now(),r={},o=!1,a=()=>{const t=Math.min((Date.now()-n)/s,1);i(e,t,r),t>=1&&(o=!0,r=null,e=null,i=null,clearInterval(h))};a();const h=setInterval(a);return()=>{o||(o=!0,r=null,e=null,i=null,a=null,clearInterval(h))}},getRandomFrom:function(...t){return t[Math.floor(Math.random()*t.length)]}},d="qwertyuiopasdfghjklzxcvbnm1234567890";function l(t=10){let e="";for(;e.length<t;)e+=d[Math.floor(Math.random()*d.length)];return e}var u=c;class f{constructor(){this.objects=new Set}add(...t){for(const e of t)this.objects.add(e)}remove(...t){for(const e of t)this.objects.delete(e)}processing(){const t=Array.from(this.objects);for(let e=0;e<t.length-1;e++){const s=t[e],i=s.bodyRect,n=s.tops,r=s.velocity.x,o=s.velocity.y;for(let a=e+1;a<t.length;a++){const e=t[a],h=e.bodyRect,c=e.tops,d=e.velocity.x,l=e.velocity.y;if(s.static&&e.static)continue;let f=!1;for(const t of n)if(f=u.isInside({x:t[0]+r,y:t[1]+o},{x:h.x+d,y:h.y+l,width:h.width,height:h.height}))break;if(!1===f)for(const t of c)if(f=u.isInside({x:t[0]+d,y:t[1]+l},{x:i.x+r,y:i.y+o,width:i.width,height:i.height}))break;f&&(s.emit("collision",e,s),e.emit("collision",s,e))}}}}class y extends n{constructor(t,e={}){super(e);const s=e.frame||{},i=e.velocity||{};this.texture=t,this.keysDefault=e.keysDefault||[],this.frames=[],this.frameNumber=0,this.frameDelay=0,this.animations={},this.animation="",this.animationPaused=!1,this.velocity={x:i.x||0,y:i.y||0},this.frame={x:s.x||0,y:s.y||0,width:s.width||t?t.width:0,height:s.height||t?t.height:0},void 0===e.width&&(this.width=this.frame.width),void 0===e.height&&(this.height=this.frame.height)}setFramesCollection(t){this.frames=t}setAnimationsCollection(t){this.animations=t}startAnimation(t){if(!this.animations.hasOwnProperty(t))return!1;const{duration:e=1/0,keys:s}=this.animations[t];this.animation=t,this.frameDelay=e/s.length,this.setFrameByKeys(...s[0])}pauseAnimation(){this.animationPaused=!0}resumeAnimation(){this.animationPaused=!1}setFrameByKeys(...t){const e=this.getFrameByKeys(...t,...this.keysDefault);if(!e)return!1;this.frame.x=e.x,this.frame.y=e.y,this.frame.width=e.width,this.frame.height=e.height,this.width=this.frame.width,this.height=this.frame.height}getFrameByKeys(...t){let e=!1;for(const s of this.frames){e=!0;for(const i of t)if(!s.keys.includes(i)){e=!1;break}if(e)return JSON.parse(JSON.stringify(s))}}tick(t){if(!this.animationPaused&&this.animation&&u.delay(this.animation+this.uid,this.frameDelay)){const{keys:t}=this.animations[this.animation];this.frameNumber=(this.frameNumber+1)%t.length,this.setFrameByKeys(...t[this.frameNumber]),this.emit("frameChange",this)}this.x+=this.velocity.x,this.y+=this.velocity.y}draw(t,e){super.draw(()=>{e.save(),e.translate(this.x,this.y),e.rotate(-this.rotation),this.texture&&e.drawImage(this.texture,this.frame.x,this.frame.y,this.frame.width,this.frame.height,this.absoluteX-this.x,this.absoluteY-this.y,this.width*this.scaleX,this.height*this.scaleY),e.restore()})}}class m extends y{constructor(t,e={}){super(t,e);const s=e.body||{};this.debug=e.debug||!1,this.static=e.static||!1,this.body={},this.body.x=s.x||0,this.body.y=s.y||0,this.body.width=s.width||1,this.body.height=s.height||1}get bodyRect(){return{x:this.absoluteX+this.width*this.scaleX*this.body.x,y:this.absoluteY+this.height*this.scaleY*this.body.y,width:this.width*this.scaleX*this.body.width,height:this.height*this.scaleY*this.body.height}}get tops(){const{x:t,y:e,width:s,height:i}=this.bodyRect;return[[t,e],[t+s,e],[t,e+i],[t+s,e+i]]}isInside(t,e){return u.isInside({x:t,y:e},this.bodyRect)}draw(t,e){if(this.visible){if(e.save(),e.translate(this.x,this.y),e.rotate(-this.rotation),e.drawImage(this.texture,this.frame.x,this.frame.y,this.frame.width,this.frame.height,this.absoluteX-this.x,this.absoluteY-this.y,this.width*this.scaleX,this.height*this.scaleY),this.debug){const{x:t,y:s,width:i,height:n}=this.bodyRect;e.fillStyle="rgba(255, 0, 0, 0.2)",e.beginPath(),e.rect(t-this.x,s-this.y,i,n),e.fill(),e.fillStyle="rgb(0, 255, 0)",e.beginPath(),e.arc(0,0,3,0,2*Math.PI),e.fill()}e.restore()}}}class g{constructor(t={}){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.background=t.background||"black",this.canvas.width=t.width||50,this.canvas.height=t.height||50}draw(t){t(this.canvas,this.context)}clear(){this.context.fillStyle=this.background,this.context.beginPath(),this.context.rect(0,0,this.canvas.width,this.canvas.height),this.context.fill()}}class b{constructor(){this.loadOrder={images:[],jsons:[],sounds:[]},this.resources={images:{},jsons:{},sounds:{}}}addImage(t,e){this.loadOrder.images.push({name:t,src:e})}addJson(t,e){this.loadOrder.jsons.push({name:t,address:e})}addSound(t,e){this.loadOrder.sounds.push({name:t,src:e})}getImage(t){return this.resources.images[t]}getJson(t){return this.resources.jsons[t]}getSound(t){return this.resources.sounds[t]}load(t){const e=[];for(const t of this.loadOrder.images){const{name:s,src:i}=t,n=b.loadImage(i).then(e=>{if(this.resources.images[s]=e,this.loadOrder.images.includes(t)){const e=this.loadOrder.images.indexOf(t);this.loadOrder.images.splice(e,1)}});e.push(n)}for(const t of this.loadOrder.jsons){const{name:s,address:i}=t,n=b.loadJson(i).then(e=>{if(this.resources.jsons[s]=e,this.loadOrder.jsons.includes(t)){const e=this.loadOrder.jsons.indexOf(t);this.loadOrder.jsons.splice(e,1)}});e.push(n)}for(const t of this.loadOrder.sounds){const{name:s,src:i}=t,n=b.loadSound(i).then(e=>{if(this.resources.sounds[s]=e,this.loadOrder.sounds.includes(t)){const e=this.loadOrder.sounds.indexOf(t);this.loadOrder.sounds.splice(e,1)}});e.push(n)}Promise.all(e).then(t)}static loadImage(t){return new Promise((e,s)=>{try{const s=new Image;s.onload=()=>e(s),s.src=t}catch(t){s(t)}})}static loadJson(t){return new Promise((e,s)=>{fetch(t).then(t=>t.json()).then(t=>e(t)).catch(t=>s(t))})}static loadSound(t){return new Promise((e,s)=>{try{(new Audio).src=t}catch(t){s(t)}})}}class p{constructor(){const t=this;this.arrowUp=!1,this.arrowDown=!1,this.arrowLeft=!1,this.arrowRight=!1,this.space=!1,document.body.addEventListener("keydown",(function(e){switch(e.code){case"KeyW":t.arrowUp=!0;break;case"KeyS":t.arrowDown=!0;break;case"KeyD":t.arrowRight=!0;break;case"KeyA":t.arrowLeft=!0;break;case"Space":t.space=!0}})),document.body.addEventListener("keyup",(function(e){switch(e.code){case"KeyW":t.arrowUp=!1;break;case"KeyS":t.arrowDown=!1;break;case"KeyD":t.arrowRight=!1;break;case"KeyA":t.arrowLeft=!1;break;case"Space":t.space=!1}}))}}class w{constructor(t={}){this.renderer=new g(t),this.loader=new b,this.scenesCollection=new r,this.keyboard=new p,t.scenes&&this.addScene(...t.scenes),t.el&&t.el.appendChild&&t.el.appendChild(this.renderer.canvas);const e=this.scenes.filter(t=>t.autoStart);for(const t of e)t.status="loading",t.loading(this.loader);this.loader.load(()=>{for(const t of e)t.status="init",t.init();for(const t of e)t.status="started"}),requestAnimationFrame(t=>this.tick(t))}addScene(...t){this.scenesCollection.add(...t);for(const e of t)e.parent=this}get scenes(){return this.scenesCollection.displayObjects}tick(t){const e=this.scenes.filter(t=>"started"===t.status);for(const s of e)s.update(t);for(const s of e)s.tick(t);this.renderer.clear();for(const t of e)t.draw(this.renderer.canvas,this.renderer.context);requestAnimationFrame(t=>this.tick(t))}getScene(t){if(t instanceof o&&this.scenes.includes(t))return t;if("string"==typeof t)for(const e of this.scenes)if(e.name===t)return e}startScene(t){const e=this.getScene(t);return!!e&&(e.status="loading",e.loading(this.loader),this.loader.load(()=>{e.status="init",e.init(),e.status="started"}),!0)}finishScene(t){const e=this.getScene(t);if(!e)return!1;e.status="finished",this.scenesCollection.remove(e),e.beforeDestroy()}}class x extends n{constructor(t={}){super(t),this.color=t.color||"red",this.x1=t.x1||0,this.y1=t.y1||0,this.x2=t.x2||0,this.y2=t.y2||0}draw(t,e){super.draw(()=>{e.strokeStyle=this.color,e.lineWidth=1,e.beginPath(),e.moveTo(this.x1,this.y1),e.lineTo(this.x2,this.y2),e.stroke()})}}class v{}class O extends n{constructor(t={}){super(t),this.color=t.color||"red"}draw(t,e){super.draw(()=>{e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,3,0,2*Math.PI),e.fill()})}}s.d(e,"ArcadePhysics",(function(){return f})),s.d(e,"Body",(function(){return m})),s.d(e,"Container",(function(){return r})),s.d(e,"DisplayObject",(function(){return n})),s.d(e,"EventEmitter",(function(){return i})),s.d(e,"Game",(function(){return w})),s.d(e,"Keyboard",(function(){return p})),s.d(e,"Line",(function(){return x})),s.d(e,"Loader",(function(){return b})),s.d(e,"Mouse",(function(){return v})),s.d(e,"Point",(function(){return O})),s.d(e,"Renderer",(function(){return g})),s.d(e,"Scene",(function(){return o})),s.d(e,"Sprite",(function(){return y})),s.d(e,"Util",(function(){return u})),Object.assign(w,{ArcadePhysics:f,Body:m,Container:r,DisplayObject:n,EventEmitter:i,Game:w,Keyboard:p,Line:x,Loader:b,Mouse:v,Point:O,Renderer:g,Scene:o,Sprite:y,Util:u});e.default=w}])}));